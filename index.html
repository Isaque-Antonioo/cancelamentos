<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="An√°lise de Cancelamentos - Dashboard de m√©tricas e insights">
    <meta name="author" content="Sua Empresa">
    <title>Hubstrom - Cancelamentos</title>

    <!-- Favicon Hubstrom -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cpath d='M161 85c2.7-1.2 5.6.8 5.6 3.7v50.3c0 1.6-.9 3-2.4 3.7L35.2 199.9c-.9.4-1.9-.3-1.9-1.2v-54.4c0-1.6.9-3 2.4-3.7L161 85z' fill='%2335CCA3'/%3E%3Cpath d='M164.8.1c.9-.4 1.9.3 1.9 1.2v54.4c0 1.6-.9 3-2.4 3.7L39 114.9c-2.7 1.2-5.6-.8-5.6-3.7V61c0-1.6.9-3 2.4-3.7L164.8.1z' fill='%2335CCA3'/%3E%3C/svg%3E">

    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Verificacao de autenticacao -->
    <script src="js/auth.js"></script>
</head>
<body class="dashboard-loading">
    <div class="container">
        <!-- Menu Lateral -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Dashboards</h3>
                <button class="sidebar-close" onclick="toggleSidebar()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li class="sidebar-item active">
                    <a href="index.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 20V10M12 20V4M6 20v-6"/>
                        </svg>
                        <span>Cancelamentos</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="comercial.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"/>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        <span>Comercial</span>
                    </a>
                </li>
                <li class="sidebar-item disabled">
                    <a href="#">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <span>CS</span>
                        <span class="badge-soon">Em breve</span>
                    </a>
                </li>
                <li class="sidebar-item disabled">
                    <a href="#">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        <span>Suporte</span>
                        <span class="badge-soon">Em breve</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <header class="header">
            <div class="header-top">
                <button class="hamburger-btn" onclick="toggleSidebar()" title="Menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <h1 class="header-main-title">An√°lise de Cancelamentos</h1>
                <div class="header-controls">
                    <select id="monthSelector" class="month-selector" onchange="handleMonthChange(this.value)">
                        <!-- Op√ß√µes geradas dinamicamente -->
                    </select>
                    <button class="btn-icon-small btn-save" onclick="saveCurrentMonth()" title="Salvar m√™s">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                    </button>
                    <button class="btn-icon-small btn-delete" onclick="deleteCurrentMonth()" title="Excluir m√™s">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </button>
                    <button class="btn-icon-small btn-logout" onclick="hubstromLogout()" title="Sair">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <p id="headerSubtitle">Carregando...</p>
        </header>

        <!-- KPIs -->
        <section class="kpi-grid">
            <!-- Linha 1: Quantidades -->
            <div class="kpi-card neutral">
                <div class="kpi-value">-</div>
                <div class="kpi-label">Total de Solicita√ß√µes</div>
            </div>
            <div class="kpi-card danger">
                <div class="kpi-value">49</div>
                <div class="kpi-label">Cancelados (74.2%)</div>
            </div>
            <div class="kpi-card success">
                <div class="kpi-value">17</div>
                <div class="kpi-label">Revertidos (25.8%)</div>
            </div>
            <div class="kpi-card warning">
                <div class="kpi-value">0</div>
                <div class="kpi-label">Em Tratativa (0%)</div>
            </div>
            <!-- Linha 2: Valores -->
            <div class="kpi-card neutral">
                <div class="kpi-value">-</div>
                <div class="kpi-label">Total Solicitado</div>
            </div>
            <div class="kpi-card danger">
                <div class="kpi-value">R$ 28.783</div>
                <div class="kpi-label">MRR Perdido</div>
            </div>
            <div class="kpi-card success">
                <div class="kpi-value">R$ 17.510</div>
                <div class="kpi-label">MRR Recuperado</div>
            </div>
            <div class="kpi-card success">
                <div class="kpi-value">37.8%</div>
                <div class="kpi-label">Taxa de Revers√£o</div>
            </div>
        </section>

        <!-- Alerta Cr√≠tico -->
        <div class="highlight-box">
            <h3>‚ö†Ô∏è ALERTA CR√çTICO: USABILIDADE</h3>
            <p style="font-size: 1.2em; margin-bottom: 10px;">
                <strong>48% dos cancelamentos</strong> (32 de 66) s√£o por problemas de USABILIDADE.
            </p>
            <p style="color: #ffffff;">
                Este √© o principal motivo e representa quase metade de todos os pedidos de cancelamento.
                A an√°lise detalhada abaixo explica exatamente o que significa "usabilidade" neste contexto.
            </p>
        </div>

        <!-- Todos os 4 Gr√°ficos Juntos -->
        <section class="charts-grid-4">
            <div class="chart-card chart-small">
                <h3>Distribui√ß√£o por Motivo Principal</h3>
                <canvas id="motivoChart"></canvas>
            </div>
            <div class="chart-card chart-small">
                <h3>Status das Solicita√ß√µes</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-card chart-small">
                <h3>Cancelamentos por Tempo de Uso</h3>
                <canvas id="tempoChart"></canvas>
            </div>
            <div class="chart-card chart-small">
                <h3>M√≥dulos Mais Problem√°ticos</h3>
                <canvas id="moduloChart"></canvas>
            </div>
        </section>

        <!-- An√°lise de Usabilidade -->
        <section class="section">
            <h2> O QUE SIGNIFICA "USABILIDADE"  <STRONG> NO PONTO DE VISTA DOS CLIENTES</STRONG> EM CANCELAMENTOS</h2>
            <p style="margin-bottom: 20px; color: #aaa;">
                Analisando os coment√°rios da coluna "Causa" e "Motivo da solicita√ß√£o", categorizamos os problemas de usabilidade:
            </p>

            <div class="problem-grid">
                <article class="problem-card">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M10.3669 8H15.9897V2.36693C15.9897 1.05427 14.9251 0 13.6227 0H2.36692C1.0646 0 0 1.0646 0 2.36693V13.6227C0 14.9354 1.0646 15.9897 2.36692 15.9897H7.98966V10.3566C7.98966 9.04394 9.05426 7.98967 10.3566 7.98967L10.3669 8Z" fill="#35CCA3"/>
                            <path d="M21.6227 8H15.9999V13.6331C15.9999 14.9457 14.9353 16 13.633 16H8.01025V21.6331C8.01025 22.9457 9.07485 24 10.3772 24H21.633C22.9353 24 23.9999 22.9354 23.9999 21.6331V10.3773C23.9999 9.0646 22.9353 8.01033 21.633 8.01033L21.6227 8Z" fill="#35CCA3"/>
                            <path d="M15.9999 13.6331V8H10.3772C9.07485 8 8.01025 9.0646 8.01025 10.3669V16H13.633C14.9353 16 15.9999 14.9354 15.9999 13.6331Z" fill="#1E293B"/>
                        </svg>
                        ConnectHub / WhatsApp (8 casos)
                    </h4>
                    <ul>
                        <li>Instabilidade na integra√ß√£o com WhatsApp</li>
                        <li>Bloqueios e banimentos frequentes pela Meta</li>
                        <li>Problemas de comunica√ß√£o com clientes</li>
                        <li>Falta de m√©tricas de atendimento</li>
                        <li>Envios duplicados e indevidos de guias</li>
                    </ul>
                </article>

                <article class="problem-card">
                    <h4> Funcionalidades N√£o Atendem (9 casos)</h4>
                    <ul>
                        <li>Falta de personaliza√ß√£o de mensagens por cliente</li>
                        <li>Impossibilidade de editar/personalizar PDFs</li>
                        <li>Layout confuso para parcelamentos</li>
                        <li>Atualiza√ß√£o de guias s√≥ para o dia corrente</li>
                        <li>Cobran√ßa de excedentes indevidos</li>
                    </ul>
                </article>

                <article class="problem-card">
                    <h4> Dificuldade de Adapta√ß√£o (7 casos)</h4>
                    <ul>
                        <li>Curva de aprendizado alta</li>
                        <li>Falta de treinamento adequado</li>
                        <li>Equipe do escrit√≥rio n√£o aderiu</li>
                        <li>Complexidade na parametriza√ß√£o</li>
                    </ul>
                </article>

                <article class="problem-card">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M3.60166 12.0001C3.60166 7.36963 7.35845 3.61768 11.9949 3.61768V12.0001H3.59131H3.60166Z" fill="#35CCA3"/>
                            <path d="M2.06986 12H3.60155C3.60155 16.6305 7.35834 20.3824 11.9948 20.3824C16.6313 20.3824 20.3881 16.6305 20.3881 12C20.3881 7.36952 16.6313 3.61757 11.9948 3.61757V2.06718C11.9948 0.930233 12.9159 0 14.0647 0H20.4502C22.4166 0 24 1.59173 24 3.55556V20.4445C24 22.4083 22.4062 24 20.4502 24H3.54981C1.58344 24 0 22.4083 0 20.4445V17.54V17.2713V14.0569C0 12.9199 0.921087 11.9897 2.06986 11.9897V12Z" fill="#35CCA3"/>
                            <path d="M20.3881 12.0001C20.3881 16.6306 16.6313 20.3825 11.9948 20.3825C7.35836 20.3825 3.60156 16.6306 3.60156 12.0001H12.0052V3.61768C16.6417 3.61768 20.3985 7.36962 20.3985 12.0001H20.3881Z" fill="#1E293B"/>
                        </svg>
                        XMLHub (4 casos)
                    </h4>
                    <ul>
                        <li>Formato de download em lote n√£o agrada</li>
                        <li>N√£o atende bem e-commerce</li>
                        <li>Instabilidades nas buscas de XML</li>
                    </ul>
                </article>

                <article class="problem-card">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M4.2931 6.37581C4.2931 6.2827 4.2931 6.19995 4.31379 6.11719H1.72758C0.77586 6.11719 0 6.89304 0 7.84477V17.1448C0 18.0965 0.77586 18.8724 1.72758 18.8724H4.31379C4.31379 18.7896 4.2931 18.6965 4.2931 18.6137V6.37581Z" fill="#35CCA3"/>
                            <path d="M11.0793 4.85511C11.0793 4.59649 11.1207 4.33788 11.1828 4.0896H6.56898C5.40002 4.0896 4.43795 4.96891 4.30347 6.10684H6.12415C7.07588 6.10684 7.85174 6.8827 7.85174 7.83442V17.1344C7.85174 18.0861 7.07588 18.862 6.12415 18.862H4.30347C4.43795 19.9999 5.40002 20.8792 6.56898 20.8792H11.1828C11.1207 20.6413 11.0793 20.3827 11.0793 20.1137V4.84475V4.85511Z" fill="#35CCA3"/>
                            <path d="M7.86218 17.1448V7.84477C7.86218 6.89304 7.08632 6.11719 6.13459 6.11719H4.3139C4.3139 6.19995 4.29321 6.29305 4.29321 6.37581V18.6137C4.29321 18.7068 4.29321 18.7896 4.3139 18.8724H6.13459C7.08632 18.8724 7.86218 18.0965 7.86218 17.1448Z" fill="#1E293B"/>
                            <path d="M21.1553 2.01035H13.9242C12.6208 2.01035 11.5242 2.88968 11.1829 4.08968H12.3725C13.6346 4.08968 14.6484 5.11381 14.6484 6.36554V18.6035C14.6484 19.8655 13.6242 20.8793 12.3725 20.8793H11.1829C11.5139 22.0793 12.6104 22.9586 13.9242 22.9586H21.1553C22.7277 22.9586 24.0001 21.6862 24.0001 20.1138V4.84483C24.0001 3.27241 22.7277 2 21.1553 2V2.01035Z" fill="#35CCA3"/>
                            <path d="M14.6483 18.6137V6.37572C14.6483 5.11365 13.6242 4.09985 12.3724 4.09985H11.1828C11.1207 4.33778 11.0793 4.59642 11.0793 4.86539V20.1343C11.0793 20.393 11.1207 20.6516 11.1828 20.8999H12.3724C13.6345 20.8999 14.6483 19.8757 14.6483 18.624V18.6137Z" fill="#1E293B"/>
                        </svg>
                        TaskHub (4 casos)
                    </h4>
                    <ul>
                        <li>Pend√™ncias n√£o atualizam ap√≥s pagamento</li>
                        <li>Configura√ß√£o de tarefas confusa</li>
                    </ul>
                </article>

                <article class="problem-card">
                    <h4> Falta de Tempo (3 casos)</h4>
                    <ul>
                        <li>N√£o conseguem dedicar tempo √† implanta√ß√£o</li>
                        <li>Sobrecarga de trabalho (in√≠cio de ano)</li>
                        <li>Pessoa respons√°vel saiu da empresa</li>
                    </ul>
                </article>
            </div>
        </section>

        <!-- SE√á√ÉO DE GERENCIAMENTO DE DADOS -->
        <section class="section data-management-section">
            <h2>üìä Gerenciamento de Dados</h2>
            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                Sincronize dados do Google Sheets e gerencie o hist√≥rico de vers√µes
            </p>

            <div class="data-controls-row">
                <!-- Sincroniza√ß√£o Google Sheets -->
                <div class="data-control-card">
                    <div class="data-control-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="3" y1="9" x2="21" y2="9"/>
                            <line x1="3" y1="15" x2="21" y2="15"/>
                            <line x1="9" y1="3" x2="9" y2="21"/>
                        </svg>
                        <span>Google Sheets</span>
                    </div>
                    <div class="data-control-content">
                        <div class="data-control-buttons">
                            <button class="btn-sync" id="btnSyncSheets" onclick="syncFromSheets()" title="Sincronizar com Google Sheets">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9"/>
                                </svg>
                                <span>Sincronizar</span>
                            </button>
                            <button class="btn-sheets-config" onclick="openSheetsConfigModal()" title="Configurar Google Sheets">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                                </svg>
                            </button>
                        </div>
                        <span id="syncStatus" class="sync-status">N√£o configurado</span>
                    </div>
                </div>

                <!-- Hist√≥rico de Vers√µes -->
                <div class="data-control-card">
                    <div class="data-control-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span>Hist√≥rico de Vers√µes</span>
                    </div>
                    <div class="data-control-content">
                        <button class="btn-history" onclick="openHistoryModal()" title="Ver hist√≥rico de vers√µes">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3v5h5"/>
                                <path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/>
                                <path d="M12 7v5l4 2"/>
                            </svg>
                            <span>Ver Todas as Vers√µes Salvas</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SE√á√ÉO DE AN√ÅLISE COM IA - DESTAQUE PREMIUM -->
        <section class="section ai-analysis-section">
            <div class="ai-header">
                <h2>An√°lise com Intelig√™ncia Artificial</h2>
                <p>
                    Gere insights estrat√©gicos automaticamente usando Claude AI
                </p>
            </div>

            <div class="ai-main-action">
                <button class="btn-generate-large" onclick="generateAIAnalysis()" id="btnGenerate" disabled>
                    <div class="btn-generate-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="btn-generate-text">
                        <span class="btn-generate-title">Gerar An√°lise com IA</span>
                        <span class="btn-generate-subtitle">Claude analisa os dados e gera recomenda√ß√µes</span>
                    </div>
                </button>

                <div class="ai-config-area">
                    <button class="btn-config-ai" onclick="openConfigModal()" title="Configurar API Key">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        <span>Configurar API</span>
                    </button>
                    <span id="apiStatus" class="api-status-indicator"></span>
                </div>
            </div>

            <div id="aiLoadingIndicator" class="ai-loading" style="display: none;">
                <div class="spinner"></div>
                <span>Analisando dados com Claude AI...</span>
            </div>
        </section>

        <!-- Concorrentes -->
        <section class="section">
            <h2> Concorrentes Mencionados</h2>
            <p style="margin-bottom: 15px; color: #aaa;">Clientes est√£o migrando para:</p>
            <div>
                <span class="competitor-tag">SIEG (4 men√ß√µes)</span>
                <span class="competitor-tag">VERI (4 men√ß√µes)</span>
                <span class="competitor-tag">ACESS√ìRIAS (3 men√ß√µes)</span>
                <span class="competitor-tag">CALIMA (1 men√ß√£o)</span>
                <span class="competitor-tag">GOB (1 men√ß√£o)</span>
                <span class="competitor-tag">NIBO (1 men√ß√£o)</span>
                <span class="competitor-tag">DIGILIZA (1 men√ß√£o)</span>
                <span class="competitor-tag">QUESTOR (1 men√ß√£o)</span>
                <span class="competitor-tag">TRON (1 men√ß√£o)</span>
                <span class="competitor-tag">Dom√≠nio (1 men√ß√£o)</span>
                <span class="competitor-tag">Makro (1 men√ß√£o)</span>
            </div>
        </section>

        <!-- Insights -->
        <section class="section" id="insightsSection">
            <h2> INSIGHTS PRINCIPAIS</h2>
            <ul class="insight-list" id="insightsList">
                <li>
                    <strong>üî¥ ConnectHub √© o maior vil√£o:</strong> Problemas de estabilidade com WhatsApp, bloqueios da Meta, e falta de m√©tricas s√£o as principais reclama√ß√µes. Clientes est√£o frustrados porque a ferramenta que deveria facilitar a comunica√ß√£o est√° causando problemas com seus pr√≥prios clientes.
                </li>
                <li>
                    <strong>üü° Per√≠odo cr√≠tico nos primeiros 6 meses:</strong> 36 de 49 cancelamentos (73%) acontecem nos primeiros 6 meses de uso. Isso indica problemas no onboarding e na adapta√ß√£o inicial.
                </li>
                <li>
                    <strong>üü° Funcionalidades b√°sicas faltando:</strong> Personaliza√ß√£o de mensagens, edi√ß√£o de PDFs, e m√©tricas s√£o demandas recorrentes que parecem n√£o estar dispon√≠veis ou s√£o dif√≠ceis de usar.
                </li>
                <li>
                    <strong>üü¢ Oportunidade de revers√£o:</strong> 25.8% das solicita√ß√µes foram revertidas (17 de 66), principalmente com descontos e ofertas de treinamento. Isso mostra que muitos clientes podem ser retidos com aten√ß√£o adequada.
                </li>
                <li>
                    <strong>üî¥ Concorr√™ncia forte:</strong> SIEG e VERI s√£o os principais concorrentes para onde os clientes est√£o migrando, especialmente para funcionalidades de XML.
                </li>
            </ul>
        </section>

        <!-- Recomenda√ß√µes -->
        <section class="section" id="recommendationsSection">
            <h2> RECOMENDA√á√ïES</h2>
            <div id="recommendationsList">
            <article class="recommendation-card">
                <h4>1. Priorizar estabilidade do ConnectHub</h4>
                <p>Investir em infraestrutura e comunica√ß√£o proativa sobre instabilidades. Criar documenta√ß√£o clara sobre pol√≠ticas da Meta e como evitar bloqueios.</p>
            </article>

            <article class="recommendation-card">
                <h4>2. Melhorar onboarding nos primeiros 90 dias</h4>
                <p>Criar programa de acompanhamento intensivo com treinamentos obrigat√≥rios e check-ins semanais. A maioria dos cancelamentos ocorre por falta de adapta√ß√£o.</p>
            </article>

            <article class="recommendation-card">
                <h4>3. Adicionar m√©tricas de atendimento</h4>
                <p>Funcionalidade solicitada por v√°rios clientes. M√©tricas de atendimento no ConnectHub podem ser um diferencial competitivo.</p>
            </article>

            <article class="recommendation-card">
                <h4>4. Permitir personaliza√ß√£o de comunica√ß√µes</h4>
                <p>Edi√ß√£o de PDFs, personaliza√ß√£o de mensagens por cliente, e nomes de arquivos customizados s√£o demandas recorrentes.</p>
            </article>

            <article class="recommendation-card">
                <h4>5. Programa de reten√ß√£o proativo</h4>
                <p>Monitorar clientes com baixa utiliza√ß√£o e entrar em contato antes que solicitem cancelamento. Descontos de 10-15% est√£o funcionando para revers√£o.</p>
            </article>
            </div>
        </section>
    </div>

    <!-- Modal de Configura√ß√£o API -->
    <div id="configModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Configura√ß√£o da API</h3>
                <button class="modal-close" onclick="closeConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <label for="apiKeyInput">Chave da API Anthropic (Claude)</label>
                <input type="password" id="apiKeyInput" placeholder="sk-ant-api03-..." />
                <p class="api-help">
                    Obtenha sua chave em: <a href="https://console.anthropic.com/settings/keys" target="_blank">console.anthropic.com</a>
                </p>
                <div class="api-status" id="apiStatus"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeConfigModal()">Cancelar</button>
                <button class="btn-primary" onclick="saveApiKey()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Hist√≥rico de Vers√µes -->
    <div id="historyModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Hist√≥rico de Vers√µes</h3>
                <button class="modal-close" onclick="closeHistoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="history-description">Visualize e restaure vers√µes anteriores dos dados. Cada sincroniza√ß√£o cria automaticamente uma vers√£o de backup.</p>
                <div id="historyList" class="history-list">
                    <div class="history-loading">Carregando hist√≥rico...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeHistoryModal()">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√£o Google Sheets -->
    <div id="sheetsConfigModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Configurar Google Sheets</h3>
                <button class="modal-close" onclick="closeSheetsConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <label for="sheetsUrlInput">URL da Planilha Google Sheets</label>
                <input type="text" id="sheetsUrlInput" placeholder="https://docs.google.com/spreadsheets/d/..." />
                <p class="api-help">
                    <strong>Importante:</strong> A planilha precisa estar publicada na web.<br>
                    V√° em <strong>Arquivo ‚Üí Compartilhar ‚Üí Publicar na web</strong> e publique como p√°gina da web.
                </p>

                <div class="month-gids-section">
                    <label style="margin-top: 20px; display: block;">GID de cada Aba (M√™s)</label>
                    <p class="api-help" style="margin-bottom: 15px;">
                        <strong>Como encontrar o gid:</strong> Clique na aba do m√™s na planilha e veja na URL: <code>gid=XXXXXXX</code><br>
                        Configure apenas os meses que voc√™ usa.
                    </p>

                    <div class="month-gids-grid">
                        <div class="month-gid-item">
                            <label for="gid_Janeiro">Janeiro</label>
                            <input type="text" id="gid_Janeiro" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Fevereiro">Fevereiro</label>
                            <input type="text" id="gid_Fevereiro" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Mar√ßo">Mar√ßo</label>
                            <input type="text" id="gid_Mar√ßo" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Abril">Abril</label>
                            <input type="text" id="gid_Abril" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Maio">Maio</label>
                            <input type="text" id="gid_Maio" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Junho">Junho</label>
                            <input type="text" id="gid_Junho" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Julho">Julho</label>
                            <input type="text" id="gid_Julho" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Agosto">Agosto</label>
                            <input type="text" id="gid_Agosto" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Setembro">Setembro</label>
                            <input type="text" id="gid_Setembro" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Outubro">Outubro</label>
                            <input type="text" id="gid_Outubro" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Novembro">Novembro</label>
                            <input type="text" id="gid_Novembro" placeholder="gid" />
                        </div>
                        <div class="month-gid-item">
                            <label for="gid_Dezembro">Dezembro</label>
                            <input type="text" id="gid_Dezembro" placeholder="gid" />
                        </div>
                    </div>
                </div>

                <label for="refreshIntervalSelect" style="margin-top: 20px; display: block;">Atualiza√ß√£o Autom√°tica</label>
                <select id="refreshIntervalSelect" class="select-input">
                    <option value="0">Desativada (manual)</option>
                    <option value="5">A cada 5 minutos</option>
                    <option value="15">A cada 15 minutos</option>
                    <option value="30">A cada 30 minutos</option>
                    <option value="60">A cada 1 hora</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn-danger" onclick="removeSheetsConfiguration()" style="margin-right: auto;">Remover</button>
                <button class="btn-secondary" onclick="closeSheetsConfigModal()">Cancelar</button>
                <button class="btn-primary" onclick="saveSheetsConfiguration()">Salvar e Sincronizar</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="js/charts.js"></script>
    <script src="js/ai-analysis.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/history-manager.js"></script>
    <script src="js/sheets-integration.js"></script>

    <!-- Controle do Menu Sidebar -->
    <script>
        // Habilitar transi√ß√µes apenas ap√≥s o carregamento completo
        document.addEventListener('DOMContentLoaded', function() {
            // Pequeno delay para garantir que o CSS foi aplicado
            setTimeout(function() {
                document.getElementById('sidebar').classList.add('ready');
            }, 50);
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');

            // Prevenir scroll do body quando sidebar est√° aberto
            if (sidebar.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        // Fechar sidebar com tecla ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const sidebar = document.getElementById('sidebar');
                if (sidebar.classList.contains('active')) {
                    toggleSidebar();
                }
            }
        });
    </script>
</body>
</html>
